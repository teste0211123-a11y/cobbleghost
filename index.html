<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pokémon Server - Minecraft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e53935;
            --primary-dark: #c62828;
            --secondary: #ffc107;
            --accent: #2e7d32;
            --light: #f5f5f5;
            --dark: #212121;
            --gray: #757575;
            --pokemon-blue: #3b4cca;
            --pokemon-red: #ff0000;
            --pokemon-yellow: #ffde00;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-attachment: fixed;
            color: var(--light);
            line-height: 1.6;
        }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        header {
            background: rgba(33, 33, 33, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
            position: sticky; top: 0; z-index: 100;
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo img { height: 50px; filter: drop-shadow(0 0 5px var(--pokemon-yellow)); }
        .logo h1 { font-size: 1.5rem; background: linear-gradient(to right, var(--pokemon-yellow), var(--pokemon-red)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 10px rgba(255, 222, 0, 0.3); }
        nav ul { display: flex; list-style: none; gap: 20px; }
        nav a { color: white; text-decoration: none; font-weight: 500; padding: 5px 10px; border-radius: 4px; transition: all 0.3s; }
        nav a:hover { background: var(--pokemon-red); transform: translateY(-2px); }
        .admin-btn { background: var(--pokemon-yellow); color: var(--dark); padding: 8px 15px; border-radius: 4px; font-weight: bold; transition: all 0.3s; cursor: pointer; border: none; }
        .admin-btn:hover { background: #ffea00; box-shadow: 0 0 10px var(--pokemon-yellow); }

        .hero { background: rgba(0,0,0,0.7); text-align: center; padding: 4rem 0; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('https://i.gifer.com/7VE.gif') center/cover no-repeat; opacity: 0.12; z-index: -1; }
        .hero h2 { font-size: 2.5rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .hero p { font-size: 1.2rem; max-width: 700px; margin: 0 auto 2rem; }
        .cta-button { display: inline-block; background: var(--pokemon-red); color: white; padding: 12px 30px; border-radius: 30px; text-decoration: none; font-weight: bold; font-size: 1.1rem; transition: transform 0.3s, background 0.3s, box-shadow 0.3s; box-shadow: 0 5px 15px rgba(229, 57, 53, 0.4); }
        .cta-button:hover { transform: translateY(-3px); background: #ff1744; box-shadow: 0 8px 20px rgba(229, 57, 53, 0.6); }

        .section-title { text-align: center; margin: 3rem 0 2rem; color: var(--pokemon-yellow); position: relative; font-size: 2rem; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .section-title:after { content: ''; display: block; width: 100px; height: 4px; background: var(--pokemon-red); margin: 10px auto; border-radius: 2px; }
        .categories { display: flex; justify-content: center; gap: 15px; margin-bottom: 2rem; flex-wrap: wrap; }
        .category-btn { background: rgba(255, 255, 255, 0.1); border: 2px solid var(--pokemon-yellow); color: var(--pokemon-yellow); padding: 8px 20px; border-radius: 30px; cursor: pointer; font-weight: 500; transition: all 0.3s; backdrop-filter: blur(5px); }
        .category-btn.active, .category-btn:hover { background: var(--pokemon-yellow); color: var(--dark); box-shadow: 0 0 10px var(--pokemon-yellow); }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-bottom: 3rem; }
        .product-card { background: rgba(255, 255, 255, 0.08); border-radius: 15px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.2); transition: transform 0.3s, box-shadow 0.3s; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.07); }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.3); }
        .product-image { height: 180px; overflow: hidden; position: relative; background: rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-badge { position: absolute; top: 10px; right: 10px; background: var(--pokemon-red); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .product-info { padding: 20px; }
        .product-title { font-size: 1.2rem; margin-bottom: 10px; color: var(--pokemon-yellow); }
        .product-price { font-size: 1.5rem; font-weight: bold; color: var(--pokemon-yellow); margin-bottom: 15px; text-shadow: 0 0 5px rgba(255, 222, 0, 0.3); }
        .buy-btn { display: block; width: 100%; background: var(--pokemon-red); color: white; text-align: center; padding: 10px; border-radius: 5px; text-decoration: none; font-weight: bold; transition: background 0.3s, transform 0.3s; border: none; cursor: pointer; }
        .buy-btn:hover { background: #ff1744; transform: scale(1.05); }

        footer { background: rgba(33, 33, 33, 0.9); color: white; padding: 3rem 0 2rem; margin-top: 3rem; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 2rem; }
        .footer-section h3 { margin-bottom: 1rem; color: var(--pokemon-yellow); }
        .footer-bottom { text-align: center; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
        .modal-content { background: rgba(33, 33, 33, 0.95); border-radius: 15px; width: 90%; max-width: 500px; padding: 30px; position: relative; border: 1px solid var(--pokemon-yellow); box-shadow: 0 0 30px rgba(255, 222, 0, 0.2); }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: var(--gray); transition: color 0.3s; }
        .close-modal:hover { color: var(--pokemon-red); }

        .admin-panel { display: none; background: rgba(33, 33, 33, 0.9); padding: 2rem; border-radius: 15px; margin: 2rem 0; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid var(--pokemon-yellow); backdrop-filter: blur(10px); }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap; }
        .admin-tab { padding: 10px 20px; background: rgba(255, 255, 255, 0.1); border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .admin-tab.active { background: var(--pokemon-yellow); color: var(--dark); }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .product-form { display: grid; gap: 15px; }
        .product-list { display: grid; gap: 15px; }
        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 5px; border-left: 4px solid var(--pokemon-yellow); }
        .product-actions button { background: var(--pokemon-red); color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-left: 5px; transition: background 0.3s; }
        .product-actions button:hover { background: #ff1744; }
        .chat-container { background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px; margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .chat-message { padding: 10px; margin-bottom: 10px; border-radius: 5px; background: rgba(255, 255, 255, 0.1); }
        .chat-message.admin { background: rgba(255, 222, 0, 0.2); border-left: 3px solid var(--pokemon-yellow); }
        .chat-message.user { background: rgba(59, 76, 202, 0.2); border-left: 3px solid var(--pokemon-blue); }
        .message-actions { display: flex; gap: 10px; margin-top: 10px; }
        .btn-approve { background: var(--accent); color: white; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-reject { background: var(--pokemon-red); color: white; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .ranking-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .ranking-table th, .ranking-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .ranking-table th { background: rgba(255, 222, 0, 0.2); color: var(--pokemon-yellow); }
        .ranking-table tr:hover { background: rgba(255, 255, 255, 0.05); }
        .rank-1 { background: rgba(255, 215, 0, 0.1); }
        .rank-2 { background: rgba(192, 192, 192, 0.1); }
        .rank-3 { background: rgba(205, 127, 50, 0.1); }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 20px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); }
        .stat-value { font-size: 2rem; font-weight: bold; color: var(--pokemon-yellow); margin: 10px 0; }
        .feedback-item { background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--pokemon-blue); }
        .feedback-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: var(--pokemon-yellow); }
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            nav ul { flex-wrap: wrap; justify-content: center; }
            .hero h2 { font-size: 2rem; }
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
            .admin-tabs { flex-direction: column; }
        }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .floating { animation: float 5s ease-in-out infinite; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <img src="https://www.freepnglogos.com/uploads/pokemon-logo-text-png-7.png" alt="Logo" style="height: 40px;">
                <h1>Pokémon Server</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#home">Início</a></li>
                    <li><a href="#products">Produtos</a></li>
                    <li><a href="#rankings">Ranking</a></li>
                    <li><a href="#about">Sobre</a></li>
                    <li><a href="https://discord.gg/9RfZ3UdVQW" target="_blank">Discord</a></li>
                    <li><button class="admin-btn" id="adminBtn"><i class="fas fa-cog"></i> Admin</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <h2>O Melhor Servidor Pokémon de Minecraft!</h2>
            <p>Junte-se a nossa comunidade e explore um mundo repleto de Pokémon, batalhas emocionantes e muito mais!</p>
            <a href="#products" class="cta-button">Ver Produtos</a>

            <div style="margin-top: 30px;">
                <img src="https://www.pngplay.com/wp-content/uploads/2/Pokeball-PNG-HD-Quality.png" alt="Pokeball" style="height: 60px; margin: 0 10px;" class="floating">
                <img src="https://www.freeiconspng.com/uploads/pokemon-png-23.png" alt="Pikachu" style="height: 80px; margin: 0 10px;" class="floating">
                <img src="https://www.pngplay.com/wp-content/uploads/2/Pokeball-PNG-HD-Quality.png" alt="Pokeball" style="height: 60px; margin: 0 10px;" class="floating">
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="products">
        <div class="container">
            <h2 class="section-title">Nossos Produtos</h2>

            <div class="categories">
                <button class="category-btn active" data-category="all">Todos</button>
                <button class="category-btn" data-category="vip">VIPs</button>
                <button class="category-btn" data-category="coins">Coins</button>
                <button class="category-btn" data-category="keys">Chaves</button>
                <button class="category-btn" data-category="kits">Kits</button>
            </div>

            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded here by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Rankings Section -->
    <section id="rankings" style="background: rgba(0,0,0,0.7); padding: 3rem 0;">
        <div class="container">
            <h2 class="section-title">Ranking de Compradores</h2>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>Total Arrecadado</h3>
                    <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                    <p>Valor total em vendas</p>
                </div>
                <div class="stat-card">
                    <h3>Compradores</h3>
                    <div class="stat-value" id="totalBuyers">0</div>
                    <p>Jogadores que compraram</p>
                </div>
                <div class="stat-card">
                    <h3>Produtos Vendidos</h3>
                    <div class="stat-value" id="totalSales">0</div>
                    <p>Itens vendidos no total</p>
                </div>
            </div>

            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>Posição</th>
                        <th>Jogador</th>
                        <th>Discord</th>
                        <th>Total Gasto</th>
                        <th>Compras</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                    <!-- Ranking will be loaded here by JavaScript -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Admin Panel -->
    <div class="container">
        <div class="admin-panel" id="adminPanel">
            <div class="admin-header">
                <h2><i class="fas fa-crown"></i> Painel Administrativo</h2>
                <button id="logoutAdmin" class="submit-btn" style="width: auto;">Sair <i class="fas fa-sign-out-alt"></i></button>
            </div>

            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="products">Gerenciar Produtos</div>
                <div class="admin-tab" data-tab="registrations">Registrar Compras</div>
                <div class="admin-tab" data-tab="rankings">Ranking (Admin)</div>
                <div class="admin-tab" data-tab="settings">Configurações</div>
                <div class="admin-tab" data-tab="feedback">Feedbacks</div>
            </div>

            <div class="admin-section active" id="productsSection">
                <h3>Adicionar Novo Produto</h3>
                <form class="product-form" id="addProductForm">
                    <div class="form-group">
                        <label for="productName">Nome do Produto</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Categoria</label>
                        <select id="productCategory" required>
                            <option value="vip">VIP</option>
                            <option value="coins">Coins</option>
                            <option value="keys">Chaves</option>
                            <option value="kits">Kits</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Preço (R$)</label>
                        <input type="number" id="productPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="productImage">URL da Imagem/GIF</label>
                        <input type="text" id="productImage" required>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">Descrição</label>
                        <textarea id="productDescription" rows="3"></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Adicionar Produto <i class="fas fa-plus"></i></button>
                </form>

                <h3 style="margin-top: 2rem;">Produtos Cadastrados</h3>
                <div class="product-list" id="adminProductList">
                    <!-- Products will be listed here -->
                </div>
            </div>

            <div class="admin-section" id="registrationsSection">
                <h3>Registrar Compras Pendentes</h3>
                <div class="chat-container" id="pendingRegistrations">
                    <!-- Pending registrations will appear here -->
                </div>

                <h3 style="margin-top: 2rem;">Registrar Nova Compra Manualmente</h3>
                <form id="manualRegistrationForm">
                    <div class="form-group">
                        <label for="manualPlayerName">Nome no Minecraft</label>
                        <input type="text" id="manualPlayerName" required>
                    </div>
                    <div class="form-group">
                        <label for="manualDiscordName">Nome no Discord</label>
                        <input type="text" id="manualDiscordName" required>
                    </div>
                    <div class="form-group">
                        <label for="manualProduct">Produto</label>
                        <select id="manualProduct" required>
                            <!-- Products will be loaded here -->
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Registrar Compra <i class="fas fa-check"></i></button>
                </form>
            </div>

            <div class="admin-section" id="rankingsSection">
                <h3>Ranking de Compradores (Visão Admin)</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Arrecadado</h3>
                        <div class="stat-value" id="adminTotalRevenue">R$ 0,00</div>
                        <p>Valor total em vendas</p>
                    </div>
                    <div class="stat-card">
                        <h3>Compras no Mês</h3>
                        <div class="stat-value" id="monthlySales">0</div>
                        <p>Vendas este mês</p>
                    </div>
                </div>

                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Posição</th>
                            <th>Jogador</th>
                            <th>Discord</th>
                            <th>Total Gasto</th>
                            <th>Última Compra</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="adminRankingBody">
                        <!-- Admin ranking will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="admin-section" id="settingsSection">
                <h3>Configurações</h3>
                <div class="form-group">
                    <label for="pixKey">Chave PIX</label>
                    <input type="text" id="pixKey" value="neverctt@gmail.com" placeholder="Sua chave PIX">
                </div>
                <div class="form-group">
                    <label for="discordLink">Link do Discord</label>
                    <input type="text" id="discordLink" value="https://discord.gg/9RfZ3UdVQW" placeholder="Link do seu Discord">
                </div>
                <button id="saveSettings" class="submit-btn">Salvar Configurações <i class="fas fa-save"></i></button>
            </div>

            <div class="admin-section" id="feedbackSection">
                <h3>Feedbacks dos Jogadores</h3>
                <div id="feedbackList">
                    <!-- Feedbacks will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <span class="close-modal" id="closePurchaseModal">&times;</span>
            <h2>Finalizar Compra</h2>
            <form id="purchaseForm">
                <div class="form-group">
                    <label for="playerName">Nome no Minecraft</label>
                    <input type="text" id="playerName" required>
                </div>
                <div class="form-group">
                    <label for="discordName">Nome no Discord</label>
                    <input type="text" id="discordName" required>
                </div>
                <div class="form-group">
                    <label>Método de Pagamento</label>
                    <div>
                        <input type="radio" id="pix" name="payment" value="pix" checked>
                        <label for="pix">PIX</label>
                    </div>
                </div>
                <div class="form-group">
                    <p><strong>Chave PIX:</strong> <span id="pixKeyDisplay">neverctt@gmail.com</span></p>
                    <p>Após o pagamento, abra um ticket no Discord enviando o comprovante.</p>
                </div>
                <div class="form-group">
                    <label for="feedback">Feedback (Opcional)</label>
                    <textarea id="feedback" rows="3" placeholder="Deixe seu feedback sobre o servidor..."></textarea>
                </div>
                <input type="hidden" id="purchaseProductId">
                <button type="submit" class="submit-btn">Enviar Registro (Pendente) <i class="fas fa-hourglass"></i></button>
            </form>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <span class="close-modal" id="closeAdminModal">&times;</span>
            <h2>Acesso Administrativo</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminPassword">Senha</label>
                    <input type="password" id="adminPassword" required>
                </div>
                <button type="submit" class="submit-btn">Acessar <i class="fas fa-lock"></i></button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Sobre Nós</h3>
                    <p>O melhor servidor Pokémon de Minecraft, com uma comunidade ativa e diversão garantida!</p>
                    <div style="margin-top: 15px;">
                        <img src="https://www.freepnglogos.com/uploads/pokemon-logo-text-png-7.png" alt="Logo" style="height: 40px; filter: brightness(0) invert(1);">
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="#home">Início</a></li>
                        <li><a href="#products">Produtos</a></li>
                        <li><a href="#rankings">Ranking</a></li>
                        <li><a href="https://discord.gg/9RfZ3UdVQW" target="_blank">Discord</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contato</h3>
                    <p>Email: neverctt@gmail.com</p>
                    <p>Discord: discord.gg/9RfZ3UdVQW</p>
                    <p>PIX: neverctt@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Pokémon Server. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        /*************************************************************************
         * CONFIG
         *************************************************************************/
        const ADMIN_PASSWORD = "mdubs25"; // <-- Altere para sua senha real
        const LOCAL_PRODUCTS_KEY = "ps_products_v1";
        const LOCAL_BUYERS_KEY = "ps_buyers_v1";
        const LOCAL_CONFIG_KEY = "ps_config_v1";
        const LOCAL_PENDING_KEY = "ps_pending_v1"; // novo: pendentes

        /*************************************************************************
         * DEFAULTS
         *************************************************************************/
        const defaultProducts = [
            {
                id: 1,
                name: "VIP Básico",
                category: "vip",
                price: 15.90,
                image: "https://i.pinimg.com/originals/2e/8b/6c/2e8b6c11b3e20b8e2f8c4e9e4e4e4e4e.gif",
                description: "Acesso a áreas VIP e comandos exclusivos"
            },
            {
                id: 2,
                name: "VIP Premium",
                category: "vip",
                price: 29.90,
                image: "https://media.tenor.com/DPY4xZR0ZcIAAAAi/pokemon-pikachu.gif",
                description: "Todos os benefícios do VIP Básico + itens exclusivos"
            },
            {
                id: 3,
                name: "10.000 Coins",
                category: "coins",
                price: 9.90,
                image: "https://media.tenor.com/2R7XnS31dUoAAAAi/pokemon-pikachu.gif",
                description: "Moeda do servidor para comprar itens especiais"
            },
            {
                id: 4,
                name: "Chave Misteriosa",
                category: "keys",
                price: 4.90,
                image: "https://media.tenor.com/2uinJbBvKYUAAAAi/pokeball-pokemon.gif",
                description: "Abra baús especiais com recompensas únicas"
            }
        ];

        /*************************************************************************
         * UTILIDADES (localStorage wrappers)
         *************************************************************************/
        function readProducts() {
            const raw = localStorage.getItem(LOCAL_PRODUCTS_KEY);
            if (!raw) {
                localStorage.setItem(LOCAL_PRODUCTS_KEY, JSON.stringify(defaultProducts));
                return [...defaultProducts];
            }
            try { return JSON.parse(raw); } catch { return [...defaultProducts]; }
        }

        function saveProducts(list) {
            localStorage.setItem(LOCAL_PRODUCTS_KEY, JSON.stringify(list));
        }

        function readBuyers() {
            const raw = localStorage.getItem(LOCAL_BUYERS_KEY);
            if (!raw) { localStorage.setItem(LOCAL_BUYERS_KEY, JSON.stringify([])); return []; }
            try { return JSON.parse(raw); } catch { return []; }
        }

        function saveBuyers(list) {
            localStorage.setItem(LOCAL_BUYERS_KEY, JSON.stringify(list));
        }

        function readPending() {
            const raw = localStorage.getItem(LOCAL_PENDING_KEY);
            if (!raw) { localStorage.setItem(LOCAL_PENDING_KEY, JSON.stringify([])); return []; }
            try { return JSON.parse(raw); } catch { return []; }
        }

        function savePending(list) {
            localStorage.setItem(LOCAL_PENDING_KEY, JSON.stringify(list));
        }

        function readConfig() {
            const raw = localStorage.getItem(LOCAL_CONFIG_KEY);
            if (!raw) {
                const cfg = { pixKey: "neverctt@gmail.com", discordLink: "https://discord.gg/9RfZ3UdVQW" };
                localStorage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(cfg));
                return cfg;
            }
            try { return JSON.parse(raw); } catch { return { pixKey: "neverctt@gmail.com", discordLink: "https://discord.gg/9RfZ3UdVQW" }; }
        }

        function saveConfig(cfg) {
            localStorage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(cfg));
        }

        /*************************************************************************
         * INTERAÇÕES DE MODAL
         *************************************************************************/
        const adminBtn = document.getElementById("adminBtn");
        const adminPanel = document.getElementById("adminPanel");
        const adminLoginModal = document.getElementById("adminLoginModal");
        const closeAdminModal = document.getElementById("closeAdminModal");
        const adminLoginForm = document.getElementById("adminLoginForm");
        const logoutAdmin = document.getElementById("logoutAdmin");

        const purchaseModal = document.getElementById("purchaseModal");
        const closePurchaseModal = document.getElementById("closePurchaseModal");
        const purchaseForm = document.getElementById("purchaseForm");
        const pixKeyDisplay = document.getElementById("pixKeyDisplay");
        const pendingRegistrations = document.getElementById("pendingRegistrations");

        adminBtn.addEventListener("click", () => {
            openModal(adminLoginModal);
        });

        closeAdminModal.addEventListener("click", () => closeModal(adminLoginModal));
        closePurchaseModal.addEventListener("click", () => closeModal(purchaseModal));

        function openModal(el) { el.classList.add("open"); el.style.display = "flex"; }
        function closeModal(el) { el.classList.remove("open"); el.style.display = "none"; }

        // Fechar modals clicando fora
        document.querySelectorAll(".modal").forEach(mod => {
            mod.addEventListener("click", (e) => {
                if (e.target === mod) closeModal(mod);
            });
        });

        // Login admin
        adminLoginForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const pwInput = document.getElementById("adminPassword").value;
            if (pwInput === ADMIN_PASSWORD) {
                closeModal(adminLoginModal);
                showAdminPanel();
            } else {
                alert("Senha incorreta!");
            }
            adminLoginForm.reset();
        });

        logoutAdmin.addEventListener("click", () => {
            adminPanel.style.display = "none";
        });

        function showAdminPanel() {
            adminPanel.style.display = "block";
            carregarProdutosAdmin();
            carregarProdutos(); // atualiza a lista pública
            preencherProdutoManualSelect();
            atualizarEstatisticas();
            carregarFeedbacks();
            carregarPendingRegistrations(); // carregar pendentes ao abrir painel
        }

        /*************************************************************************
         * PRODUTOS (listar, adicionar, remover)
         *************************************************************************/
        const productsGrid = document.getElementById("productsGrid");
        const addProductForm = document.getElementById("addProductForm");
        const adminProductList = document.getElementById("adminProductList");

        function carregarProdutos() {
            const lista = readProducts();
            productsGrid.innerHTML = "";
            lista.forEach(prod => {
                const card = document.createElement("div");
                card.className = "product-card";
                card.innerHTML = `
                    <div class="product-image">
                        <img src="${escapeHtml(prod.image)}" alt="${escapeHtml(prod.name)}">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${escapeHtml(prod.name)}</h3>
                        <div class="product-price">R$ ${Number(prod.price).toFixed(2)}</div>
                        <p style="margin-bottom:10px; color: #ddd;">${escapeHtml(prod.description || '')}</p>
                        <button class="buy-btn" data-id="${prod.id}"><i class="fas fa-shopping-cart"></i> Comprar</button>
                    </div>
                `;
                productsGrid.appendChild(card);
            });
        }

        // Escapa texto simples para evitar injeção simples (não é substituto de backend seguro)
        function escapeHtml(text) {
            if (text === undefined || text === null) return "";
            return String(text).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        }

        addProductForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const lista = readProducts();
            const nextId = lista.length ? Math.max(...lista.map(p => p.id)) + 1 : 1;
            const novo = {
                id: nextId,
                name: document.getElementById("productName").value.trim(),
                category: document.getElementById("productCategory").value,
                price: parseFloat(document.getElementById("productPrice").value) || 0,
                image: document.getElementById("productImage").value.trim(),
                description: document.getElementById("productDescription").value.trim()
            };
            lista.push(novo);
            saveProducts(lista);
            e.target.reset();
            carregarProdutosAdmin();
            carregarProdutos();
            preencherProdutoManualSelect();
            alert("Produto cadastrado com sucesso!");
        });

        function carregarProdutosAdmin() {
            const lista = readProducts();
            adminProductList.innerHTML = "";
            lista.forEach((p, idx) => {
                adminProductList.innerHTML += `
                    <div class="product-item">
                        <div>
                            <strong>${escapeHtml(p.name)}</strong> — R$ ${Number(p.price).toFixed(2)} <br>
                            <small style="color:#ccc">${escapeHtml(p.category)} — ${escapeHtml(p.description || '')}</small>
                        </div>
                        <div class="product-actions">
                            <button onclick="editarProduto(${p.id})" title="Editar (apenas remover+adicionar por enquanto)">Editar</button>
                            <button onclick="removerProduto(${p.id})">Excluir</button>
                        </div>
                    </div>
                `;
            });
        }

        window.removerProduto = function(id) {
            if (!confirm("Deseja realmente excluir este produto?")) return;
            let lista = readProducts();
            lista = lista.filter(p => p.id !== id);
            saveProducts(lista);
            carregarProdutosAdmin();
            carregarProdutos();
            preencherProdutoManualSelect();
        };

        // edição simples: preenche o formulário para recriar (implementação básica)
        window.editarProduto = function(id) {
            const lista = readProducts();
            const p = lista.find(x => x.id === id);
            if (!p) return alert("Produto não encontrado.");
            document.getElementById("productName").value = p.name;
            document.getElementById("productCategory").value = p.category;
            document.getElementById("productPrice").value = p.price;
            document.getElementById("productImage").value = p.image;
            document.getElementById("productDescription").value = p.description;
            // remove o antigo para evitar duplicidade quando salvar:
            lista.splice(lista.indexOf(p), 1);
            saveProducts(lista);
            carregarProdutosAdmin();
            carregarProdutos();
            preencherProdutoManualSelect();
        };

        /*************************************************************************
         * COMPRAS (modal de compra, registrar) -> agora cria PENDENTE
         *************************************************************************/
        // Delegation: abrir modal de compra ao clicar botão comprar
        document.body.addEventListener("click", (e) => {
            const bt = e.target.closest(".buy-btn");
            if (!bt) return;
            const prodId = Number(bt.dataset.id);
            const lista = readProducts();
            const prod = lista.find(p => p.id === prodId);
            if (!prod) return alert("Produto não encontrado.");
            document.getElementById("purchaseProductId").value = prodId;
            pixKeyDisplay.textContent = readConfig().pixKey || "neverctt@gmail.com";
            openModal(purchaseModal);
        });

        // Antes: salvava direto em buyers. Agora salvamos em pendentes (status: pending)
        purchaseForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const id = Number(document.getElementById("purchaseProductId").value);
            const prod = readProducts().find(p => p.id === id);
            if (!prod) return alert("Produto inválido.");

            const pendingItem = {
                playerName: document.getElementById("playerName").value.trim(),
                discordName: document.getElementById("discordName").value.trim(),
                productId: id,
                productName: prod.name,
                price: Number(prod.price),
                date: new Date().toISOString(),
                feedback: document.getElementById("feedback").value.trim(),
                status: "pending"
            };

            const pend = readPending();
            pend.push(pendingItem);
            savePending(pend);

            closeModal(purchaseModal);
            purchaseForm.reset();
            // NÃO atualiza estatísticas (ainda pendente)
            carregarPendingRegistrations();
            alert("Registro enviado! Aguarde confirmação do ADM.");
        });

        /*************************************************************************
         * REGISTRO MANUAL (admin)
         *************************************************************************/
        const manualRegistrationForm = document.getElementById("manualRegistrationForm");

        function preencherProdutoManualSelect() {
            const sel = document.getElementById("manualProduct");
            const lista = readProducts();
            sel.innerHTML = "";
            lista.forEach(p => {
                const opt = document.createElement("option");
                opt.value = p.id;
                opt.textContent = `${p.name} — R$ ${Number(p.price).toFixed(2)}`;
                sel.appendChild(opt);
            });
        }

        // Registro manual do admin continua aprovando direto (porque é o ADM que registra)
        manualRegistrationForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const player = document.getElementById("manualPlayerName").value.trim();
            const discord = document.getElementById("manualDiscordName").value.trim();
            const prodId = Number(document.getElementById("manualProduct").value);
            const prod = readProducts().find(p => p.id === prodId);
            if (!prod) return alert("Produto inválido.");

            const buyer = {
                playerName: player,
                discordName: discord,
                productId: prodId,
                productName: prod.name,
                price: Number(prod.price),
                date: new Date().toISOString(),
                feedback: ""
            };

            const buyers = readBuyers();
            buyers.push(buyer);
            saveBuyers(buyers);
            manualRegistrationForm.reset();
            atualizarEstatisticas();
            carregarProdutosAdmin();
            preencherProdutoManualSelect();
            alert("Compra registrada manualmente (aprovada).");
        });

        /*************************************************************************
         * PENDENTES: exibir, aprovar, recusar
         *************************************************************************/
        function carregarPendingRegistrations() {
            const pend = readPending();
            pendingRegistrations.innerHTML = "";

            if (pend.length === 0) {
                pendingRegistrations.innerHTML = "<p>Nenhuma compra pendente.</p>";
                return;
            }

            pend.forEach((p, i) => {
                const dateStr = p.date ? new Date(p.date).toLocaleString() : "-";
                pendingRegistrations.innerHTML += `
                    <div class="chat-message user" style="display:block;">
                        <div><strong>${escapeHtml(p.playerName)}</strong> — ${escapeHtml(p.discordName || "-")}</div>
                        <div style="margin:6px 0"><strong>${escapeHtml(p.productName)}</strong> — R$ ${Number(p.price).toFixed(2)}</div>
                        <div style="font-size:0.85rem;color:#ccc">Enviado: ${dateStr}</div>
                        ${p.feedback ? `<div style="margin-top:6px;color:#ddd">${escapeHtml(p.feedback)}</div>` : ""}
                        <div class="message-actions" style="margin-top:8px;">
                            <button class="btn-approve" onclick="aprovarCompra(${i})"><i class="fas fa-check"></i> Aprovar</button>
                            <button class="btn-reject" onclick="recusarCompra(${i})"><i class="fas fa-times"></i> Recusar</button>
                        </div>
                    </div>
                `;
            });
        }

        window.aprovarCompra = function(index) {
            const pend = readPending();
            const item = pend[index];
            if (!item) return alert("Item pendente não encontrado.");

            // Adiciona como aprovado nos buyers
            const buyers = readBuyers();
            buyers.push({
                playerName: item.playerName,
                discordName: item.discordName,
                productId: item.productId,
                productName: item.productName,
                price: Number(item.price),
                date: new Date().toISOString(),
                feedback: item.feedback || ""
            });
            saveBuyers(buyers);

            // remove dos pendentes
            pend.splice(index, 1);
            savePending(pend);

            carregarPendingRegistrations();
            atualizarEstatisticas();
            alert("Compra aprovada e adicionada ao arrecadado.");
        };

        window.recusarCompra = function(index) {
            const pend = readPending();
            const item = pend[index];
            if (!item) return alert("Item pendente não encontrado.");
            if (!confirm(`Recusar o registro de ${item.playerName} - ${item.productName}?`)) return;
            pend.splice(index, 1);
            savePending(pend);
            carregarPendingRegistrations();
            alert("Registro recusado e removido dos pendentes.");
        };

        /*************************************************************************
         * ESTATÍSTICAS E RANKING (agora consideram só buyers aprovados)
         *************************************************************************/
        function atualizarEstatisticas() {
            const buyers = readBuyers(); // aprovados apenas
            const totalRevenue = buyers.reduce((s, b) => s + (Number(b.price) || 0), 0);
            const totalBuyers = new Set(buyers.map(b => b.playerName)).size;
            const totalSales = buyers.length;

            document.getElementById("totalRevenue").textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById("totalBuyers").textContent = totalBuyers;
            document.getElementById("totalSales").textContent = totalSales;

            document.getElementById("adminTotalRevenue").textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById("monthlySales").textContent = buyers.filter(b => {
                const d = new Date(b.date);
                const now = new Date();
                return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
            }).length;

            carregarRanking();
            carregarRankingAdmin();
        }

        function carregarRanking() {
            const buyers = readBuyers();
            // agrupar por jogador
            const map = {};
            buyers.forEach(b => {
                if (!map[b.playerName]) map[b.playerName] = { player: b.playerName, discord: b.discordName || "-", total: 0, count: 0 };
                map[b.playerName].total += Number(b.price) || 0;
                map[b.playerName].count += 1;
            });
            const arr = Object.values(map).sort((a,b) => b.total - a.total);
            const tbody = document.getElementById("rankingBody");
            tbody.innerHTML = "";
            arr.forEach((r, i) => {
                tbody.innerHTML += `<tr class="${i===0?'rank-1':''} ${i===1?'rank-2':''} ${i===2?'rank-3':''}">
                    <td>${i+1}</td>
                    <td>${escapeHtml(r.player)}</td>
                    <td>${escapeHtml(r.discord)}</td>
                    <td>R$ ${Number(r.total).toFixed(2)}</td>
                    <td>${r.count}</td>
                </tr>`;
            });
        }

        function carregarRankingAdmin() {
            const buyers = readBuyers();
            // agrupar por jogador
            const map = {};
            buyers.forEach(b => {
                if (!map[b.playerName]) map[b.playerName] = { player: b.playerName, discord: b.discordName || "-", total: 0, last: null, count: 0 };
                map[b.playerName].total += Number(b.price) || 0;
                map[b.playerName].count += 1;
                map[b.playerName].last = (!map[b.playerName].last || new Date(b.date) > new Date(map[b.playerName].last)) ? b.date : map[b.playerName].last;
            });
            const arr = Object.values(map).sort((a,b) => b.total - a.total);
            const tbody = document.getElementById("adminRankingBody");
            tbody.innerHTML = "";
            arr.forEach((r, i) => {
                tbody.innerHTML += `<tr>
                    <td>${i+1}</td>
                    <td>${escapeHtml(r.player)}</td>
                    <td>${escapeHtml(r.discord)}</td>
                    <td>R$ ${Number(r.total).toFixed(2)}</td>
                    <td>${r.last ? new Date(r.last).toLocaleString() : '-'}</td>
                    <td><button onclick="adminRemoverComprador('${escapeHtml(r.player)}')">Remover Histórico</button></td>
                </tr>`;
            });
        }

        window.adminRemoverComprador = function(playerName) {
            if (!confirm("Remover todo o histórico de compras desse jogador?")) return;
            let buyers = readBuyers();
            buyers = buyers.filter(b => b.playerName !== playerName);
            saveBuyers(buyers);
            atualizarEstatisticas();
            alert("Histórico removido.");
        };

        /*************************************************************************
         * FEEDBACKS (exibir)
         *************************************************************************/
        function carregarFeedbacks() {
            const buyers = readBuyers();
            const feedbackList = document.getElementById("feedbackList");
            const feedbacks = buyers.filter(b => b.feedback && b.feedback.trim().length);
            if (!feedbackList) return;
            feedbackList.innerHTML = "";
            if (!feedbacks.length) {
                feedbackList.innerHTML = "<p>Nenhum feedback recebido ainda.</p>";
                return;
            }
            feedbacks.forEach(f => {
                feedbackList.innerHTML += `
                    <div class="feedback-item">
                        <div class="feedback-header">
                            <strong>${escapeHtml(f.playerName)}</strong>
                            <small>${new Date(f.date).toLocaleString()}</small>
                        </div>
                        <div>${escapeHtml(f.feedback)}</div>
                    </div>
                `;
            });
        }

        /*************************************************************************
         * SETTINGS SALVAR
         *************************************************************************/
        document.getElementById("saveSettings").addEventListener("click", () => {
            const pix = document.getElementById("pixKey").value.trim();
            const discord = document.getElementById("discordLink").value.trim();
            saveConfig({ pixKey: pix, discordLink: discord });
            alert("Configurações salvas.");
            pixKeyDisplay.textContent = pix;
        });

        /*************************************************************************
         * ADMIN TABS
         *************************************************************************/
        document.querySelectorAll(".admin-tab").forEach(tab => {
            tab.addEventListener("click", () => {
                document.querySelectorAll(".admin-tab").forEach(t => t.classList.remove("active"));
                tab.classList.add("active");
                const target = tab.dataset.tab;
                document.querySelectorAll(".admin-section").forEach(sec => sec.classList.remove("active"));
                document.getElementById(target + "Section").classList.add("active");
                // Se o admin abrir a aba de "registrations", garantir que pendentes carreguem
                if (target === "registrations") carregarPendingRegistrations();
            });
        });

        /*************************************************************************
         * CATEGORIA FILTRO (público)
         *************************************************************************/
        document.querySelectorAll(".category-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                const cat = btn.dataset.category;
                filtrarCategoria(cat);
            });
        });

        function filtrarCategoria(cat) {
            const lista = readProducts();
            productsGrid.innerHTML = "";
            const filtrado = cat === "all" ? lista : lista.filter(p => p.category === cat);
            filtrado.forEach(prod => {
                const card = document.createElement("div");
                card.className = "product-card";
                card.innerHTML = `
                    <div class="product-image">
                        <img src="${escapeHtml(prod.image)}" alt="${escapeHtml(prod.name)}">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${escapeHtml(prod.name)}</h3>
                        <div class="product-price">R$ ${Number(prod.price).toFixed(2)}</div>
                        <p style="margin-bottom:10px; color: #ddd;">${escapeHtml(prod.description || '')}</p>
                        <button class="buy-btn" data-id="${prod.id}"><i class="fas fa-shopping-cart"></i> Comprar</button>
                    </div>
                `;
                productsGrid.appendChild(card);
            });
        }

        /*************************************************************************
         * INICIALIZAÇÃO
         *************************************************************************/
        function init() {
            // carrega defaults se necessário
            readProducts();
            readBuyers();
            readPending();
            const cfg = readConfig();
            document.getElementById("pixKey").value = cfg.pixKey || "neverctt@gmail.com";
            document.getElementById("discordLink").value = cfg.discordLink || "https://discord.gg/9RfZ3UdVQW";
            carregarProdutos();
            carregarProdutosAdmin();
            preencherProdutoManualSelect();
            atualizarEstatisticas();
            carregarPendingRegistrations();
            carregarFeedbacks();
        }

        init();
    </script>
</body>
</html>


